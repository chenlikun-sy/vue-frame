<template id=abcd><div id=main class=ln-mobile-alarm><transition name=el-zoom-in-top><el-card shadow=always class=cardInfo v-show=cardInfo.show :body-style="{ padding: '0' }" v-bind:style={top:getCardTop,left:getCardLeft}><div><div v-for="item in alarmInfoList"><div>{{item.name}}</div><div><img src=../../../imgs/arrow_l_1.png></div></div></div><div><div v-for="item in alarmInfo"><div>{{item.value}}</div><div></div></div></div></el-card></transition></div></template><script lang='es6'>"use strict";define(["vju"],function(t){return t.component("zhang-test-d3",{template:template,data:function(){return{screenWidth:2600,screenHeight:1350,currCircleR:50,curG:null,hoverG:null,alarmInfoLists:[],alarmInfoList:[],alarmInfo:[],tempLinkList:[],index:0,timer:null,timer0:null,toNext:!1,curNodeSourceList:[],curLinkSourceList:[],cardInfo:{show:!1,type:0,top:0,left:0}}},computed:{getCardTop:function(){var t=.85*this.screenHeight;return this.cardInfo.top+150>t?this.cardInfo.top-250+50+"px":this.cardInfo.top-120+"px"},getCardLeft:function(){var t=.85*this.screenWidth;return this.cardInfo.left+300+50>t?this.cardInfo.left-600-50+"px":this.cardInfo.left+50+"px"}},destroyed:function(){},mounted:function(){this.drawChart(),this.filterNodeLine()},methods:{drawChart:function(){var t=this.$d3.select("#main").append("svg").attr("width",this.screenWidth).attr("height",this.screenHeight).on("click",this.svgBackGroundClick),r=t.append("g").attr("transform","translate(0,50)");this.curG=r,this.hoverG=t.append("g").attr("transform","translate(0,50)"),this.getRectFirst(r),this.getRectMq(r),this.getRectCommand(r),r.append("marker").attr("id","arrow").attr("viewBox","0 0 10 10").attr("refX","10").attr("refY","5").attr("markerWidth","5").attr("markerHeight","4").attr("orient","auto").append("path").attr("stroke","rgb(18, 150, 219)").attr("stroke-width","2").attr("stroke-linecap","round").attr("stroke-linejoin","round").attr("fill","rgb(132, 194, 147)").attr("d","M 0 0 L 10 5 L 0 10"),this.getDataTestByNode()},getRectFirst:function(t){t.append("g").attr("transform",function(t){return"translate(380,200)"}).append("image").attr("xlink:href",function(){return"imgs/topo_bg.png"}).attr("src",function(){return"imgs/topo_bg.png"}).attr("x",0).attr("y",0).attr("width",1900).attr("height",200)},getRectMq:function(t){var r=t.append("g").attr("transform",function(t){return"translate(30,730)"});r.append("image").attr("xlink:href",function(){return"imgs/order_bg.png"}).attr("src",function(){return"imgs/order_bg.png"}).attr("x",0).attr("y",0).attr("width",700).attr("height",160),r.append("text").attr("dx",30).attr("dy",140).style("text-anchor","middle").style("fill","#8FB49F").style("font-size","20px").text("MQ")},getRectCommand:function(t){var r=t.append("g").attr("transform",function(t){return"translate(30,930)"});r.append("image").attr("xlink:href",function(){return"imgs/order_bg.png"}).attr("src",function(){return"imgs/order_bg.png"}).attr("x",0).attr("y",0).attr("width",700).attr("height",160),r.append("text").attr("dx",50).attr("dy",140).style("text-anchor","middle").style("fill","#8FB49F").style("font-size","20px").text("命令中心")},initNodeLine:function(){var n=this,i=[];this.curNodeSourceList.forEach(function(t){var r=n.setNode(n.curG,t.nodID,t.nodNam,t.dx,t.dy,t.src);i.push(r)}),this.curLinkSourceList.forEach(function(r){var t=i.find(function(t){return t.id===r.AnodeId?t:null}),e=i.find(function(t){return t.id===r.ZnodeId?t:null});t&&e&&n.setLine(n.curG,t,e)})},setNode:function(t,r,e,n,i,a){var o=this,d="node_"+r,s=this.$d3,c=t.append("g").attr("id",d).attr("transform",function(){return"translate("+n+","+i+")"}).on("click",function(){o.svgNodeClick(s.event,c)});return c.append("circle").attr("r",this.currCircleR).attr("style","fill: rgb(0, 47, 183)").attr("stroke","rgb(255, 255, 255)").style("cursor","pointer").attr("stroke-width","3"),c.append("image").attr("width",50).attr("height",50).attr("xlink:href",function(){if(a)return"imgs/"+a.toString()}).attr("src",function(){if(a)return"imgs/"+a.toString()}).attr("x",-25).attr("y",-25).style("cursor","pointer"),c.append("text").attr("dx",function(){return a?60:0}).attr("dy",function(){return a?70:5}).style("text-anchor","middle").style("fill","#fff").style("font-size","24px").style("cursor","pointer").text(e),c.dx=n,c.dy=i,c.id=r,c},setLine:function(t,r,e){var n=this,i=80,a=this.currCircleR,o="link_"+r.id+"to"+e.id;return t.append("path").attr("fill","none").attr("stroke-width","2px").attr("id",o).attr("d",function(){return 0<e.dy-r.dy-i?n.getPathDownLink(r,e,i,a):0<e.dx-r.dx-i?n.getPathRightLink(r,e,i,a):e.dx-r.dx+i<0?n.getPathLeftLink(r,e,i,a):n.getPathUpLink(r,e,i,a)}).attr("style",function(){return"stroke: rgb(132, 194, 147)"}).attr("marker-end","url(#arrow)")},getPathDownLink:function(t,r,e,n){return"M"+t.dx+" "+(t.dy+n)+"L"+t.dx+" "+(t.dy+e)+"L"+r.dx+" "+(t.dy+e)+"L"+r.dx+" "+(r.dy-n)},getPathRightLink:function(t,r,e,n){return"M"+(t.dx+n)+" "+t.dy+"L"+(t.dx+e)+" "+t.dy+"L"+(t.dx+e)+" "+r.dy+"L"+(r.dx-n)+" "+r.dy},getPathLeftLink:function(t,r,e,n){return"M"+(t.dx-n)+" "+t.dy+"L"+(t.dx-e)+" "+t.dy+"L"+(t.dx-e)+" "+r.dy+"L"+(r.dx+n)+" "+r.dy},getPathUpLink:function(t,r,e,n){return"M"+t.dx+" "+(t.dy+n)+"L"+t.dx+" "+(t.dy+e)+"L"+r.dx+" "+(t.dy+e)+"L"+r.dx+" "+(r.dy+n)},getDataTestByNode:function(){},getDataTestByLink:function(){},svgBackGroundClick:function(){this.toNext||this.index++,this.toNext=!1,this.cardInfo.show=!1,clearInterval(this.timer),clearInterval(this.timer0),this.setTimerShowUi()},svgNodeClick:function(t,e){t.stopPropagation();var n=this;n.toNext=!0,clearInterval(n.timer),clearInterval(n.timer0),n.alarmInfoList=[],n.alarmInfo=[],this.cardInfo.show=!1,n.findAlarmInfo(e.id,function(t){var r;this.cardInfo.show=!0,this.cardInfo.top=e.dy,this.cardInfo.left=e.dx,t&&0<t.length?(this.alarmInfoList=t,r=0,this.timer0=setInterval(function(){n.alarmInfo.push(t[r]),++r>=t.length&&clearInterval(n.timer0)},3e3)):this.alarmInfo=[{value:"未找到相关数据！"}]}.bind(this))},dragStart:function(){},dragEnd:function(){},dragDrag:function(t,r,e){var n=this.$d3,i=e[0].getAttribute("id"),a=this.curNodeSourceList.find(function(t){return"node_"+t.nodID===i.toString()?t:null});a&&(a.dx=Number(n.event.x),a.dy=Number(n.event.y)),this.drawChartByDrag()},drawChartByDrag:function(){this.$d3.select("svg").remove(),this.drawChart()},setTimerShowUi:function(){var d=this;this.timer=setInterval(function(){var t,r=d.tempLinkList[d.index],e="node_"+r.endnode,n="link_"+r.starNode+"to"+r.endnode,i=document.querySelector("#"+e),a=document.querySelector("#"+n),o=document.querySelector(".node-circle-doing");o&&(o.classList.value=""),i&&(i.firstChild.classList.value="node-circle-doing"),d.hoverG.select("path").remove(),a.attributes&&(t=a.attributes.d.value.toString(),d.hoverG.append("path").attr("id","link_007").attr("class","link--doing").attr("d",t).attr("stroke-width","4px").attr("style",function(){return"stroke: rgb(132, 194, 147)"})),d.findAlarmInfo(r.endnode,function(t){var r,e,n;t&&0<t.length?(clearInterval(d.timer),d.alarmInfoList=t,d.alarmInfo=[],i&&(e=(r=i.attributes[1].value.substring(9)).substring(1,r.length-1).split(","),d.cardInfo.show=!0,1==d.cardInfo.show&&(d.cardInfo.top=Number(e[1]),d.cardInfo.left=Number(e[0])),n=0,d.timer0=setInterval(function(){d.alarmInfo.push(t[n]),++n>=t.length&&clearInterval(d.timer0)},3e3))):d.index++}.bind(this))},3e3)},filterNodeLine:function(){},findAlarmInfo:function(t,r){var e=[];getDataBaseInfo({type:"select",id:"ln_Operations_topo_data",parameter:{nodeid:t}}).then(function(t){t&&t.forEach(function(t){var r={id:t.NODEID,name:t.DADANAME,value:t.DADAVALUE,time:t.TIME};e.push(r)}),r(e)})}}})});</script><style scoped>@keyframes regionLineAnimation{0%{stroke-dashoffset:100}100%{stroke-dashoffset:0}}@keyframes fade{from{opacity:1}50%{opacity:.5}to{opacity:1}}@keyframes bounce{0%{fill:#c63500}50%{fill:transparent}to{fill:#c63500}}.ln-mobile-alarm{width:100%;height:100%;background:#000829;position:relative}.link--doing{fill:none;stroke:red!important;stroke-miterlimit:10;stroke-dasharray:8,8;stroke-dashoffset:100;animation:regionLineAnimation 4s linear forwards infinite}.node{width:53px;height:53px}.node-circle-doing{animation:bounce 2s ease-in-out infinite}.cardInfo{width:600px;height:300px;position:absolute;font-family:Microsoft YaHei;font-size:24px;background-color:transparent;border:1px solid #023dcb;color:#fff;z-index:10}.cardInfo>div{width:100%;height:100%;display:flex}.cardInfo>div>div{height:calc(100% - 20px);padding:10px;display:flex;flex-direction:column}.cardInfo>div>div:nth-of-type(1){width:30%;justify-content:space-between;align-items:center;background:#020c33}.cardInfo>div>div:nth-of-type(1)>div:nth-last-of-type(1)>div:nth-last-of-type(1){display:none}.cardInfo>div>div:nth-of-type(1) img{width:24px;height:24px;position:relative;top:10px}.cardInfo>div>div:nth-of-type(1)>div>div{text-align:center}.cardInfo>div>div:nth-of-type(1)>div:nth-of-type(1),.cardInfo>div>div:nth-of-type(1)>div:nth-of-type(2){color:#38ff33}.cardInfo>div>div:nth-of-type(1)>div:nth-of-type(3),.cardInfo>div>div:nth-of-type(1)>div:nth-of-type(4){color:#00f6ff}.cardInfo>div>div:nth-of-type(2){width:70%;background:rgba(7,27,115,.6)}.cardInfo>div>div:nth-of-type(2)>div>div{height:40px}</style>